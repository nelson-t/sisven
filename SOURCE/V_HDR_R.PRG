PROCEDURE V_HDR_R
*****************
CURRENT=SELECT()
WRECNO =RECNO()
T_COD_CL =SPACE(8)    
T_COD_VEN=SPACE(3)
T_ESTADO =SPACE(1)
T_NOTAS1 =Space(25)
T_NOTAS2 =Space(25)
T_PLACA  =SPACE(10)
T_MARCA  =SPACE(10)
T_COLOR  =SPACE(15)
T_FECHAI =DATE()
T_FECHAF =DATE()
TNROS="..\TMP\"+SYS(3)+".DBF"
CHODESCR=""
OKCANCEL=1
DO V_HDR_R.SPR

IF OKCANCEL=3 .OR. LASTKEY()=27
  WAIT "CANCELADO..." WINDOW
ELSE

  SELECT hh_nro, hh_cod_cl, cl_razon, hh_cod_ven, hh_fecha, hh_estado, hh_placa, sum(lh_nr_kg) AS KG, sum(lh_nr_impo) AS IMPORTE ;
     from v_hdr_hd, v_hdr_ln, v_client ;
     where hh_empr=lh_empr and hh_nro=lh_nro and hh_empr=cl_empr and hh_cod_cl=cl_cod_cl AND ;
     HH_COD_CL=ALLTRIM(T_COD_CL) AND HH_COD_ven =ALLTRIM(T_COD_ven) AND ;
     HH_ESTADO=ALLTRIM(T_ESTADO) AND ;
     HH_NOTAS1=ALLTRIM(T_NOTAS1) AND HH_NOTAS2=ALLTRIM(T_NOTAS2) AND ;
     HH_PLACA=ALLTRIM(T_PLACA)   AND HH_MARCA=ALLTRIM(T_MARCA) AND ;
     HH_COLOR=ALLTRIM(T_COLOR)   AND BETWEEN(HH_FECHA,T_FECHAI, T_FECHAF) ;
     order by lh_nro group by lh_nro ;
     INTO DBF (TNROS)

  FNROS="..\TMP\"+SYS(3)+".TXT"

  REPORT FORM V_HDRCHO TO (FNROS) 

  IF OKCANCEL=1           
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM (FNROS) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  ELSE
    *IMPRIMIR REPORTE
    _PADVANCE='FORMFEED'
    ACTIVATE SCREEN
    SAVE SCREEN TO SC_HDR
    ! COPY &FNROS_FILE lpt1:
    RESTORE SCREEN FROM SC_HDR
    MENSAJE1='EL REPORTE HA SIDO IMPRESO.'
    MENSAJE2=''
    DO V_MENSAJ.SPR
  ENDIF
  DELE FILE (FNROS)
  USE
  DELE FILE (TNROS)
ENDIF
