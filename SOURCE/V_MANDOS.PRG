PROCEDURE V_MANDOS
******************
** MANTENIMIENTO DOSIFICACIONES SIN

IF .NOT. V_USRAUT(USER,"DOSIFICAS",2)  
   RETURN
ENDIF

CLOSE DATA
SET DELE ON
SET TALK OFF
SET EXCLU OFF
SET EXACT OFF
SET DATE TO DMY
PRIMERA=' '

IF TYPE("EMPRESA")="U" OR TYPE("MI_EMPRESA")="U"
  DO V_GETEMP
ENDIF

SELECT 1
USE V_DOSIFI ORDER NRO
SET FILTER TO EMPR=EMPRESA

GO BOTT
RECN=RECNO()

CLEAR

DEFINE WINDOW  MOD_TC FROM 2,2 TO 20,78

ON KEY LABEL F10 KEYBOARD CHR(23)
ON KEY LABEL F4  DO ADDLINE
ON KEY LABEL F8  DO DELLINE
ON KEY LABEL F2  DO V_DOSIFI.SPR

ON KEY LABEL ALT+HOME GO TOP
ON KEY LABEL ALT+END GO BOTT

@ 21,2 to 24,78 DOUBLE
@ 22,5 SAY '[F2]-EDITA  [F4]-ADICIONA REGISTRO  [F8]-BORRA REGISTRO  [F10]-SALIR' COLOR GR+/B
@ 23,5 SAY '            Alt+HOME-IR A INICIO   Alt+END-IR AL FINAL' 

@ 0,0 SAY DATE()

DO WHILE LASTKEY()<>23
  BROWSE NODELETE NOEDIT WINDOW MOD_TC TITLE "DOSIFICACION DE FACTURAS COMPUTARIZADAS" ;
  VALID ESVALIDO()
ENDDO

CLOSE DATA
RELEASE WINDOW MOD_TC

ON KEY LABEL F10 
ON KEY LABEL F4  
ON KEY LABEL F8  

ON KEY LABEL ALT+HOME 
ON KEY LABEL ALT+END 

CLEAR
RETURN     

PROCEDURE DELLINE
*****************
IF LOCK()
 IF NRO=0
   RECN=-1   
 ELSE
   RECN=RECNO()
 ENDIF
 DELETE
 IF RECN = -1
   GO BOTT
 ELSE
   GO RECN
 ENDIF
 KEYBOAR '{ESC}'
ELSE
 WAIT "NO SE PUEDE BORRAR...INTENTE OTRA VEZ MAS TARDE" WINDOW
ENDIF
RETURN
 
FUNCTION ESVALIDO
*****************
IF DE_FECHA={  /  /    } .OR. A_FECHA={  /  /    } .OR. NRO=0
  RETURN .F.
ELSE
  RETURN .T.
ENDIF

PROCEDURE ADDLINE
*****************
IF EOF()
  ELNRO=1
ELSE
  GO BOTT
  ELNRO=V_DOSIFI.NRO+1
ENDIF
IF ELNRO=1  
  APPEND BLANK
  REPLACE EMPR WITH EMPRESA, NRO WITH ELNRO
ELSE
  SCATTER MEMVAR
  APPEND BLANK
  GATHER MEMVAR
  REPLACE EMPR WITH EMPRESA, NRO WITH ELNRO
ENDIF

KEYBOAR '{ESC}'

RETURN