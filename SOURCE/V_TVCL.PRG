* PROGRAMA PARA OBTENER REPORTE DE TOTAL DE VENTAS POR CLIENTE

CLOSE DATA
CLEAR
STORE ' ' TO CATEGO,LINEA
STORE SPACE(30) TO MI_GLOSA,MI_GLOSA1,SUB_TIT,MI_EMPRESA,LINE_DESCR,CATE_DESCR,CLI_DESCR

IVA=0.87   && 1-0.13
EMPRESA=' '
STORE {  /  /    } TO FECHAI,FECHAF
STORE 1 TO TV_CATEGO,TV_LINE,TV_OPC,OPCION
STORE " "  TO LINEA,COD_CL
DO SET_AMBI

DO V_TVCL.SPR

IF LASTKEY()=27
  CLOSE ALL
  RETURN
ENDIF

DO CASE
  CASE TV_OPC=1 .AND. OPCION=1 
    SELECT V_FAC_LN
    SET ORDER TO CLI_PART
    REPO=SYS(3)+'.TXT'
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO.AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. ;
            LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCL WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI ;
            .AND. LF_FECHA<=FECHAF.AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCL WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI ;
            .AND. LF_FECHA<=FECHAF .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' ;
             TO FILE (REPO)
    ENDCASE
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE 'PRESIONE [Esc] - PARA SALIR'
    MODI COMM (REPO) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
    DELETE FILE (REPO)
  CASE TV_OPC=1 .AND. OPCION=2 
    SELECT V_FAC_LN
    SET ORDER TO CLI_PART
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE V_TVCL.TXT
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA) .AND. LF_ESTADO<>'A' TO FILE V_TVCL.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO.AND. LF_ESTADO<>'A' TO FILE V_TVCL.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            REPORT FORM V_TVCL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' ;
            TO FILE V_TVCL.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCL WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI ;
            .AND. LF_FECHA<=FECHAF.AND. LF_ESTADO<>'A' TO FILE V_TVCL.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCL WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI ;
            .AND. LF_FECHA<=FECHAF .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A';
             TO FILE V_TVCL.TXT
    ENDCASE
    ! NPRINT V:V_TVCL.TXT NB NFF Q=SERVER 
  CASE TV_OPC=2 .AND. OPCION=1 
    CLOSE DATA
    DO V_RPROCE WITH EMPRESA, FECHAI, FECHAF
    DO SET_AMBI
    SELECT V_FAC_LN 
    REPO=SYS(3)+'.TXT'
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            SUB_TIT='REPORTE GENERAL'
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            SUB_TIT='TODAS LAS CATEGORIAS - LINEA : '+LINE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE (REPO)       
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            SUB_TIT='CATEGORIA : '+CATE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_CLIENT.CL_CATEGO=CATEGO.AND. LF_ESTADO<>'A' TO FILE (REPO)       
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            SUB_TIT='CATEGORIA : '+CATE_DESCR+' - LINEA : '+LINE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A';
            TO FILE (REPO)       
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            SUB_TIT='CLIENTE : '+CLI_DESCR
            SELECT V_FAC_LN
            SET ORDER TO CLI_PART
            SEEK EMPRESA+COD_CL
            REPORT FORM V_RLINEA WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            SUB_TIT='CLIENTE : '+CLI_DESCR+' - LINEA : '+LINE_DESCR
            SELECT V_FAC_LN
            SET ORDER TO CLI_PART
            SEEK EMPRESA+COD_CL
            REPORT FORM V_RLINEA WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA) .AND. LF_ESTADO<>'A' TO FILE (REPO)            
    ENDCASE
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE 'PRESIONE [Esc] - PARA SALIR'
    MODI COMM (REPO) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
    DELETE FILE (REPO)    
  CASE TV_OPC=2 .AND. OPCION=2 
    CLOSE DATA
    DO V_RPROCE WITH EMPRESA, FECHAI, FECHAF
    DO SET_AMBI
    SELECT V_FAC_LN 
    SET ORDER TO PARTN
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            SUB_TIT='REPORTE GENERAL'
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF.AND. LF_ESTADO<>'A';
            TO FILE V_TVLINE.TXT
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            SUB_TIT='TODAS LAS CATEGORIAS - LINEA : '+LINE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA) .AND. LF_ESTADO<>'A' TO FILE V_TVLINE.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            SUB_TIT='CATEGORIA : '+CATE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_CLIENT.CL_CATEGO=CATEGO .AND. LF_ESTADO<>'A' TO FILE V_TVLINE.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            SUB_TIT='CATEGORIA : '+CATE_DESCR+' - LINEA : '+LINE_DESCR
            REPORT FORM V_RLINEA FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA) .AND. LF_ESTADO<>'A' TO FILE V_TVLINE.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            SUB_TIT='CLIENTE : '+CLI_DESCR
            SELECT V_FAC_LN
            SET ORDER TO CLI_PART
            SEEK EMPRESA+COD_CL
            REPORT FORM V_RLINEA WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE V_TVLINE.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            SUB_TIT='CLIENTE : '+CLI_DESCR+' - LINEA : '+LINE_DESCR
            SELECT V_FAC_LN
            SET ORDER TO CLI_PART
            SEEK EMPRESA+COD_CL
            REPORT FORM V_RLINEA WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ; 
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA) .AND. LF_ESTADO<>'A' TO FILE V_TVLINE.TXT
    ENDCASE
    ! NPRINT V:V_TVLINE.TXT NB NFF Q=SERVER 
  CASE TV_OPC=3 .AND. OPCION=1 
    SELECT V_FAC_LN
    SET ORDER TO CLI_PART
    REPO=SYS(3)+'.TXT'
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE (REPO)       
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCLR WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            LF_ESTADO<>'A' TO FILE (REPO)
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            SEEK EMPRESA+COD_CL
            REPORT FORM V_TVCLR WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE (REPO)       
    ENDCASE
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE 'PRESIONE [Esc] - PARA SALIR'
    MODI COMM (REPO) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP
    DELETE FILE (REPO)
  CASE TV_OPC=3 .AND. OPCION=2 
    SELECT V_FAC_LN
    SET ORDER TO CLI_PART
    REPO=SYS(3)+'.TXT'
    DO CASE
       CASE TV_CATEGO=1 .AND. TV_LINE=1
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF ;
            .AND. LF_ESTADO<>'A' TO FILE V_TVCLR.TXT
       CASE TV_CATEGO=1 .AND. TV_LINE=2
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE V_TVCLR.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=1
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. LF_ESTADO<>'A' TO FILE V_TVCLR.TXT
       CASE TV_CATEGO=2 .AND. TV_LINE=2
            REPORT FORM V_TVCLR FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_CLIENT.CL_CATEGO=CATEGO .AND. V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE V_TVCLR.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=1
            REPORT FORM V_TVCLR WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            LF_ESTADO<>'A' TO FILE V_TVCLR.TXT
       CASE TV_CATEGO=3 .AND. TV_LINE=2
            REPORT FORM V_TVCLR WHILE LF_COD_CL=COD_CL FOR LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. ;
            V_ITEMS.IT_LINEA=ALLTRIM(LINEA).AND. LF_ESTADO<>'A' TO FILE V_TVCLR.TXT       
    ENDCASE
    ! NPRINT V:V_TVCLR.TXT NB NFF Q=SERVER 
ENDCASE
CLOSE ALL
RETURN
    
FUNCTION GET_EMPR
*****************
PARAMETER EMPR
SELECT 0
USE V_EMPR ORDER EMPR
SEEK EMPR
IF EOF()
  USE
  RETURN .F.
ELSE
  MI_EMPRESA=ALLTRIM(EM_DESCR)
  @ 6,41 SAY MI_EMPRESA
  USE
  RETURN .T.
ENDIF

FUNCTION GET_CATEGO
*******************
PARAMETER CATEGORIA
SELECT 0
USE V_CATEGO ORDER CATEGO
SEEK EMPRESA+CATEGORIA
IF FOUND()
   CATE_DESCR=ALLTRIM(CA_DESCR)
   WAIT WINDOW 'CATEGORIA : '+ALLTRIM(CA_DESCR) NOWAIT
   USE
   RETURN .T.
ELSE  
   USE
   RETURN .F.
ENDIF

FUNCTION GET_LINE
*****************
PARAMETER LINE
SELECT V_LINEAS
SEEK EMPRESA+LINE
IF FOUND()
   LINE_DESCR=ALLTRIM(LI_DESCR)
   WAIT WINDOW 'LINEA : '+ALLTRIM(LI_DESCR) NOWAIT
   RETURN .T.
ELSE  
   RETURN .F.
ENDIF

FUNCTION GLOSA
**************
MI_GLOSA=V_LINEAS.LI_DESCR
RETURN ' '

FUNCTION GLOSA1
**************
SELECT V_ITEMS
SET RELATION TO IT_EMPR+SUBSTR(IT_LINEA,1,1)+'  ' INTO V_LINEAS
MI_GLOSA1=V_LINEAS.LI_DESCR
SET RELATION TO IT_EMPR+SUBSTR(IT_LINEA,1,2)+' ' INTO V_LINEAS
SELECT V_FAC_LN
RETURN ' '

PROCEDURE SET_AMBI
******************
SET EXCLU OFF
SET TALK OFF
SET DELE ON
SET DATE TO FRENCH
SELECT 1
  USE V_CLIENT ORDER CODIGO  
SELECT 2
  USE V_LINEAS ORDER LINEA  
SELECT 3
  USE V_TC ORDER FECHA  
SELECT 4
  USE V_ITEMS ORDER PART
SELECT 5
  USE V_FAC_LN ORDER CLI_PART
  SET RELATION TO LF_EMPR+LF_PART   INTO V_ITEMS  ADDITIVE
  SET RELATION TO DTOS(LF_FECHA)    INTO V_TC     ADDITIVE
  SET RELATION TO LF_EMPR+LF_COD_CL INTO V_CLIENT ADDITIVE
RETURN