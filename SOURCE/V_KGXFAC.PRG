* LLENA TABLA DE LINEAS / KG POR FACTURAR
TIPO='R'

SET DELE ON
SET EXCLU OFF
SET TALK OFF

SELECT 1
USE V_ITEMS ORDER PART

SELECT 2
USE V_DOC_LN ORDER CORRE
SET RELATION TO LD_EMPR+LD_PART INTO V_ITEMS

SELECT 3
USE V_LINEAS ORDER LINEA

T_LINEAS=SYS(3)
COPY TO (T_LINEAS) WITH CDX

USE (T_LINEAS) ORDER LINEA ALIAS V_LINEAK

SELECT V_DOC_LN
SEEK EMPRESA

DO WHILE .NOT. EOF() .AND. LD_EMPR=EMPRESA
  IF LD_TIPO=TIPO .AND. .NOT. LD_ESTADO$'FA' .AND. BETWEEN(LD_FECHA,FECHAI,FECHAF) .AND. LD_COD_CL<>'0' .AND. LD_COD_CL<>'211'
      IF SUBSTR(V_ITEMS.IT_LINEA,3,1)<>' '
        LINEA=V_ITEMS.IT_LINEA
        SELECT V_LINEAK
        SEEK EMPRESA+LINEA
        IF FOUND()
          REPLACE LI_KGXFACT WITH LI_KGXFACT+V_DOC_LN.LD_PESO
        ELSE
          ? ' LINEA NO EXISTE !! '+V_ITEMS.IT_LINEA
        ENDIF     
      ENDIF
      IF SUBSTR(V_ITEMS.IT_LINEA,2,1)<>' '
        LINEA=SUBSTR(V_ITEMS.IT_LINEA,1,2)+' '
        SELECT V_LINEAK
        SEEK EMPRESA+LINEA
        IF FOUND()
          REPLACE LI_KGXFACT WITH LI_KGXFACT+V_DOC_LN.LD_PESO
        ELSE
          ? ' LINEA NO EXISTE !! '+V_ITEMS.IT_LINEA
        ENDIF     
      ENDIF
      IF SUBSTR(V_ITEMS.IT_LINEA,1,1)<>' '
        LINEA=SUBSTR(V_ITEMS.IT_LINEA,1,1)
        SELECT V_LINEAK
        SEEK EMPRESA+LINEA
        IF FOUND()
          REPLACE LI_KGXFACT WITH LI_KGXFACT+V_DOC_LN.LD_PESO
        ELSE
          ? ' LINEA NO EXISTE !! '+V_ITEMS.IT_LINEA
        ENDIF     
      ENDIF
  ENDIF
  SELECT V_DOC_LN
  SKIP
ENDDO

CLOSE DATA
SELECT 1
USE (T_LINEAS) ORDER LINEA ALIAS V_LINEAK
RETURN