SET EXCLU OFF
CLOSE DATA
SET DATE TO DMY
SET DELE ON
SET TALK OFF

SELECT 1
USE V_CLIENT  ORDER CODIGO
DO WHILE .NOT. EOF()
  IF LOCK()
    REPLACE CL_SALD_DB WITH 0, CL_SALD_HB WITH 0, CL_SALD_AC WITH 0 
  ENDIF
  SKIP
ENDDO  

SELECT 2
USE V_FAC_HD ORDER CORRE
SELECT 3
USE V_REC_HD ORDER CORRE

SELECT V_FAC_HD
SET RELATION TO HF_EMPR+HF_COD_CL INTO V_CLIENT

DO WHILE .NOT. EOF()
  IF HF_TIPO<>'O' .AND. HF_ESTADO<>'A'.AND. LOCK('V_CLIENT')
   DO CASE 
     CASE HF_TIPO='R'
       REPLACE V_CLIENT.CL_SALD_DB WITH V_CLIENT.CL_SALD_DB+hf_importe-HF_DSCTO_M-ROUND(hf_importe*(HF_DSCTO_P/100),2)+hf_fletes+hf_embala+hf_otros 
     CASE HF_TIPO='X'  && NOTA DE CREDITO
       REPLACE V_CLIENT.CL_SALD_HB WITH V_CLIENT.CL_SALD_HB+hf_importe
     CASE HF_TIPO='Y'  && NOTA DE DEBITO
       REPLACE V_CLIENT.CL_SALD_DB WITH V_CLIENT.CL_SALD_DB+hf_importe
     CASE HF_TIPO='Z'  && COMUN. INTERNA
       REPLACE V_CLIENT.CL_SALD_DB WITH V_CLIENT.CL_SALD_DB+hf_importe
   ENDCASE
   ? HF_NRO,HF_COD_CL,V_CLIENT.CL_RAZON
  ENDIF
  SKIP
ENDDO

SELECT V_REC_HD
SET RELATION TO HR_EMPR+HR_COD_CL INTO V_CLIENT

DO WHILE .NOT. EOF()
  IF HR_ESTADO<>'A' .AND. LOCK('V_CLIENT')
    REPLACE V_CLIENT.CL_SALD_HB WITH V_CLIENT.CL_SALD_HB+HR_TOT_BS
    ? HR_NRO,HR_COD_CL,V_CLIENT.CL_RAZON
  ENDIF
  SKIP
ENDDO

CLOSE DATA
SELECT 1
USE V_CLIENT ORDER CODIGO
REPLACE ALL CL_SALD_AC WITH CL_SALD_AN+CL_SALD_DB-CL_SALD_HB FOR LOCK()
CLOSE DATA
