******************
PROCEDURE V_HDR_OP
******************
IF .NOT. V_USRAUT(USER,"HOJAS_DR",2)
    WAIT "NO ESTA AUTORIZADO PARA ESTA OPERACION !" WINDOW TIMEOUT 1 
    RETURN
ENDIF

OPCION=1
DO V_HDR_O.SPR
DO CASE
  CASE LASTKEY()<>27 .AND. OPCION=1 
    IF V_HDR_HD.HH_ESTADO$'AC'
       WAIT "OPERACION NO PERMITIDA EN ESTADOS 'A' Y 'C'" WINDOW TIMEOUT 2
       RETURN
    ENDIF
    DO HDR_MODI
  CASE LASTKEY()<>27 .AND. OPCION=2
    IF V_HDR_HD.HH_ESTADO='A'
       WAIT "OPERACION NO PERMITIDA EN ESTADO 'A'" WINDOW TIMEOUT 2
       RETURN
    ENDIF
    MENSAJE1='SE *IMPRIMIRA* LA HOJA DE RUTA NRO.'+V_HDR_HD.HH_NRO 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO HDR_IMPR WITH "TODO"
    ENDIF
    SELECT V_HDR_HD
  CASE LASTKEY()<>27 .AND. OPCION=3
    IF V_HDR_HD.HH_ESTADO='A'
       WAIT "OPERACION NO PERMITIDA EN ESTADO 'A'" WINDOW TIMEOUT 2
       RETURN
    ENDIF
    MENSAJE1='SE *IMPRIMIRA* DETALLE DE HOJA DE RUTA NRO.'+V_HDR_HD.HH_NRO 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO HDR_IMPR WITH "DETALLE"
    ENDIF
    SELECT V_HDR_HD
  CASE LASTKEY()<>27 .AND. OPCION=4
    DO CASE
      CASE V_HDR_HD.HH_ESTADO='A'
       WAIT "OPERACION NO PERMITIDA EN ESTADO 'A'" WINDOW TIMEOUT 2
       RETURN
      CASE V_HDR_HD.HH_ESTADO=' ' OR V_HDR_HD.HH_ESTADO='M'
        MENSAJE1='SE *CERRARA* LA HOJA DE RUTA NRO.'+V_HDR_HD.HH_NRO 
        MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR OPERACION'
        DO V_MENSAJ.SPR
        IF LASTKEY()<>27
          SELECT V_HDR_HD
          IF LOCK()
            REPLACE HH_ESTADO  WITH 'C'
            REPLACE HH_MODI    WITH DATE()
            REPLACE HH_USUARIO WITH USER
          ENDIF
        ENDIF
      CASE V_HDR_HD.HH_ESTADO='C'
        MENSAJE1='SE *REABRIRA* LA HOJA DE RUTA NRO.'+V_HDR_HD.HH_NRO 
        MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR OPERACION'
        DO V_MENSAJ.SPR
        IF LASTKEY()<>27
          SELECT V_HDR_HD
          IF LOCK()
            REPLACE HH_ESTADO  WITH ' '
            REPLACE HH_MODI    WITH DATE()
            REPLACE HH_USUARIO WITH USER
          ENDIF
        ENDIF
    ENDCASE
  CASE LASTKEY()<>27 .AND. OPCION=5
    DO V_HDR_R.PRG
*  CASE LASTKEY()<>27 .AND. OPCION=6
*    DO HDR_CORR    
  CASE LASTKEY()=27  .OR.  OPCION=6
    * SALIR
ENDCASE
DO HDR_VER
RETURN

PROCEDURE HDR_IMPR
******************
PARAMETER OP
SELECT V_HDR_LN
SEEK V_HDR_HD.HH_EMPR+V_HDR_HD.HH_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.TXT'
_PADVANCE='LINEFEED'

DO CASE
  CASE OP="TODO"
    REPORT FORM V_HDR NOCONSOLE ;
	  REST WHILE LH_EMPR+LH_NRO=V_HDR_HD.HH_EMPR+V_HDR_HD.HH_NRO ;
	  TO FILE (TEMP_FILE)
  CASE OP="DETALLE"
    REPORT FORM V_HDRDET NOCONSOLE ;
	  REST WHILE LH_EMPR+LH_NRO=V_HDR_HD.HH_EMPR+V_HDR_HD.HH_NRO ;
	  TO FILE (TEMP_FILE)
ENDCASE
  	
_PADVANCE='FORMFEED'
ACTIVATE SCREEN
SAVE SCREEN TO SC_HDR
! COPY &TEMP_FILE lpt1:
RESTORE SCREEN FROM SC_HDR
GO TOP
*modi comm (TEMP_FILE)
MENSAJE1='HOJA DE RUTA NRO.:'+V_HDR_HD.HH_NRO+' HA SIDO IMPRESA'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE HDR_CORR
******************
MENSAJE1='!!!! INGRESE AUTORIZACION !!!!' 
DO V_INPWD.SPR
*ALT+F2    
IF lastkey()<>105
       RETURN
ENDIF

CURRENT=SELECT()
SELECT V_CORRE
USE V_CORRE ORDER EMPRESA
SEEK EMPRESA
IF EOF()
  SELECT (CURRENT)
  RETURN 
ENDIF
  
PROXIMO=VAL(CO_HDR)+1
PROXIMO=RIGHT('00000'+ALLTRIM(STR(PROXIMO)),6)
OPCION=1

DO WHILE .T.
  DO V_HDR_MC.SPR
  DO CASE
    CASE OPCION=1
      EXIT
    CASE OPCION=2
     PROXIMO=VAL(PROXIMO)+1
     PROXIMO=RIGHT('00000'+ALLTRIM(STR(PROXIMO)),6)
    CASE OPCION=3
     PROXIMO=VAL(PROXIMO)-1
     PROXIMO=RIGHT('00000'+ALLTRIM(STR(PROXIMO)),6)
  ENDCASE
  IF OPCION=1
    EXIT
  ENDIF
ENDDO

PROXIMO=VAL(PROXIMO)-1
PROXIMO=RIGHT('00000'+ALLTRIM(STR(PROXIMO)),6)

IF LOCK()
   REPLACE CO_HDR WITH PROXIMO
ENDIF
UNLOCK
FLUSH
USE
USE V_CORRE ORDER EMPRESA
SELECT (CURRENT)
RETURN
