******************
PROCEDURE V_REC_OP
******************
OPCION=1
DO V_REC_O.SPR
DO CASE
  CASE LASTKEY()<>27 .AND. OPCION=1
    DO REC_MODI
  CASE LASTKEY()<>27 .AND. OPCION=2
    IF .NOT. V_USRAUT(USER,"RECIBOS",3) 
      RETURN
    ENDIF
    DO REC_CORR
  CASE LASTKEY()<>27 .AND. OPCION=3
*   IMPRIME COPIAS DE LA REMISION
    MENSAJE1='SE IMPRIMIRA RECIBO NRO.'+V_REC_HD.HR_NRO 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO REC_IMPR
    ENDIF
    SELECT V_REC_HD
  CASE LASTKEY()=27  .OR.  OPCION=4
ENDCASE
DO REC_VER
RETURN

PROCEDURE REC_IMPR
******************
SELECT V_REC_LN
SEEK V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.TXT'
_PADVANCE='LINEFEED'
REPORT FORM V_RECIBO NOCONSOLE ;
	REST WHILE LR_EMPR+LR_NRO=V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO ;
	TO FILE (TEMP_FILE)
_PADVANCE='FORMFEED'

ACTIVATE SCREEN
SAVE SCREEN TO SC1
! COPY &TEMP_FILE lpt1:
RESTORE SCREEN FROM SC1
GO TOP

*modi comm (TEMP_FILE)
MENSAJE1='RECIBO NRO.:'+V_REC_HD.HR_NRO+' HA SIDO IMPRESO'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE REC_MODI
*****************
IF .NOT. V_USRAUT(USER,"RECIBOS",2) 
    RETURN
ENDIF

SELECT V_REC_HD

SCATTER MEMVAR
RECNUM=RECNO()

IF HR_TIPO='E'           
  TIPO_REC=1
ELSE
  TIPO_REC=2
ENDIF

OKCANCEL=1

DO V_REC_M.SPR

IF OKCANCEL=2 .OR. LASTKEY()=27
  GATHER MEMVAR
  GO RECNUM
  DO V_REC_V.SPR
  RETURN
ENDIF

IF LOCK()
  REPLACE HR_ESTADO  WITH 'M'
  REPLACE HR_MODI    WITH DATE()
  REPLACE HR_USUARIO WITH USER
ENDIF

IF TIPO_REC=1
  REPLACE HR_TIPO WITH 'E'
ELSE
  REPLACE HR_TIPO WITH 'C'
ENDIF

DO V_REC_V.SPR
        
SELECT V_REC_LN
DEFINE WINDOW REC_ADD FROM 9, 0 TO 24,79 DOUBLE 

FOR N=1 TO NROLINEAS-1
APPEND BLANK
IF LOCK()
 REPLACE LR_EMPR   WITH V_REC_HD.HR_EMPR
 REPLACE LR_NRO    WITH V_REC_HD.HR_NRO
 REPLACE LR_FECHA  WITH V_REC_HD.HR_FECHA
 REPLACE LR_COD_CL WITH V_REC_HD.HR_COD_CL
ENDIF            
ENDFOR  
GO TOP
		
ON KEY LABEL F10 KEYBOARD CHR(23)
BROWSE KEY V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO  ;
 FIELDS LR_DESCR:H='CONCEPTO',LR_DOC:H='DOCUMENTO',LR_MONTO:H='MONTO Bs.':P='9999999.99' ;
 WINDOW REC_ADD TITLE 'DETALLE  -  [F10] PARA SALIR'

SEEK V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO
DELE REST WHILE .NOT. EOF() .AND. V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO=LR_EMPR+LR_NRO ;
    FOR LR_MONTO=0

SEEK V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO
DO WHILE .NOT. EOF() AND LR_EMPR+LR_NRO=V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO
     REPLACE LR_COD_CL WITH V_REC_HD.HR_COD_CL, ;
     		 LR_FECHA  WITH V_REC_HD.HR_FECHA , ;
     		 LR_ESTADO WITH V_REC_HD.HR_ESTADO
     SKIP             
ENDDO

SEEK V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO
SUM REST WHILE .NOT. EOF() .AND. V_REC_HD.HR_EMPR+V_REC_HD.HR_NRO=LR_EMPR+LR_NRO ;
    LR_MONTO TO TOTAL_BS
        
SELECT V_REC_HD
IF LOCK()
  REPLACE HR_TOT_BS WITH TOTAL_BS
ENDIF

RELEASE WINDOW REC_ADD
DO V_ONKEYS
DO REC_VER
RETURN
