PROCEDURE V_LOGIN
*****************
PUBLIC SUSER
SET EXACT ON
CLOSE DATA 

SUSER=SPACE(15)    && SYSTEM USER
PSW=SPACE(15)      && ENCRIPTED PASSWORD

OKCANCEL=1
VALIDUSER=.F.

*CHECK USER 
SELECT 0
USE V_USERS ORDER U_ID
INTENTO=1

*TRES INTENTOS
DO WHILE INTENTO<=3 .AND. OKCANCEL<>2
  DO V_GETPAS.spr
  IF OKCANCEL=2
    WAIT "SALIENDO DEL SISTEMA ..." TIMEOUT 1 WINDOW
    QUIT
  ENDIF

  SUSER=UPPER(SUSER)
  LOCATE FOR UPPER(U_NOMBRE)=SUSER .AND. U_PASSWORD=PSW

  IF EOF() .OR. LASTKEY()=27 
    WAIT "NOMBRE O PASSWORD ERRONEOS..." TIMEOUT 1 WINDOW
    INTENTO=INTENTO+1
    IF INTENTO>3
      WAIT "SALIENDO DEL SISTEMA ..." TIMEOUT 1 WINDOW
      QUIT
    ENDIF
  ELSE
    IF U_STATUS<>1
      WAIT "CUENTA DESHABILITADA..." TIMEOUT 2 WINDOW
      QUIT
    ELSE
      EXIT
    ENDIF
  ENDIF
ENDDO  

USE

RETURN

