* PROGRAMA PARA OBTENER NOTAS DE REMISION POR FACTURAR POR CLIENTE

SET EXCLU OFF
SET DELE ON
CLOSE DATA
CLEAR
SET TALK OFF

SELECT 1
   USE V_CLIENT ORDER CODIGO
SELECT 2
   USE V_PED_HD ORDER CORRE
SELECT 3
   USE V_ITEMS ORDER PART
SELECT 4
   USE V_PED_LN ORDER CORRE
   SET RELATION TO LP_EMPR+LP_NRO INTO V_PED_HD
SELECT 5
   USE V_DOC_HD ORDER NR
   SET RELATION TO HD_EMPR+HD_PEDIDO INTO V_PED_LN ADDITIVE
SELECT 6
   USE V_DOC_LN ORDER CLIENT
   SET RELATION TO LD_EMPR+LD_TIPO+LD_NRO INTO V_DOC_HD ADDITIVE
   SET RELATION TO LD_EMPR+LD_PART        INTO V_ITEMS  ADDITIVE
   SET RELATION TO LD_EMPR+LD_COD_CL      INTO V_CLIENT ADDITIVE
EXCLUIR='211|   |   '

EMPRESA=' '
FECHAI={  /  /  }
FECHAF={  /  /  }
OPCION=1
MI_EMPRESA=SPACE(30)

DO V_NRXFAC.SPR

IF LASTKEY()=27 .OR. OPCION=3
 CLOSE DATA
 CLEAR 
 RETURN
ENDIF

NRS=SYS(3)
NRS_REP='V:'+NRS+'.TXT' 

SELECT V_DOC_LN
SET FILTER TO LD_EMPR=EMPRESA .AND. .NOT. LD_ESTADO$'AF' .AND. LD_TIPO$'NR' .AND. BETWEEN(LD_FECHA,FECHAI,FECHAF) ;
              .AND. LD_COD_CL<>'000' .AND. LD_COD_CL<>'203128'.AND. LD_COD_CL<>'201497'.AND. LD_PART='T'.AND. .NOT. SUBSTR(LD_COD_CL,1,3)$EXCLUIR

DO CASE
  CASE OPCION=1 .AND. LASTKEY()<>27
    REPORT FORM V_NRXFXC TO FILE (NRS_REP) 
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM (NRS_REP) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  CASE OPCION=2 .AND. LASTKEY()<>27
    REPORT FORM V_NRXFXC TO FILE (NRS_REP) 
    ! COPY &NRS_REP lpt1:
  CASE OPCION=3 .OR. LASTKEY()=27
ENDCASE
CLEAR
CLOSE DATA
DELETE FILE (NRS_REP)
RETURN

FUNCTION GET_EMPR
*****************
PARAMETER EMPR
SELECT 0
USE V_EMPR ORDER EMPR
SEEK EMPR
IF EOF()
  USE
  RETURN .F.
ELSE
  MI_EMPRESA=EM_DESCR
  @ 8,37 SAY MI_EMPRESA
  USE
  RETURN .T.
ENDIF
