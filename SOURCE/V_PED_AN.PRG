PROCEDURE V_PED_AN
******************
*ANULA PEDIDO

IF .NOT. V_USRAUT(USER,"PEDIDOS",3)
  RETURN
ENDIF

SELECT V_PED_HD
IF HP_ESTADO<>'C' .and. HP_ESTADO<>'P'
    MENSAJE1='!!!!  NO SE PUEDE ANULAR !!!!!' 
    MENSAJE2='EL PEDIDO SOLO PUEDE SER MODIFICADO MIENTRAS TENGA ESTADO = COTIZACION'
    DO V_MENSAJ.SPR
    RETURN
ENDIF
DEFINE WINDOW ANULA_WI FROM 8,20 TO 10,60 DOUBLE TITLE 'DESEA ANULAR ESTE DOCUMENTO ?' && COLOR B/G,,B/G,B/G,N+/G
ACTIVATE WINDOW ANULA_WI
SINO='N'
@ 0,5 SAY '          (S/N):' GET SINO PICTURE '!' VALID SINO$'SN'
READ
IF SINO='S'
  IF LOCK()
    REPLACE HP_ESTADO WITH 'A'
    REPLACE HP_OBS WITH '** ANULADO **'
    REPLACE HP_USUARIO WITH USER
    REPLACE HP_IMPORTE WITH 0, HP_DSCTO_P WITH 0, HP_ESTADO WITH 'A'
    SELECT V_PED_LN
    SEEK V_PED_HD.HP_EMPR+V_PED_HD.HP_NRO
    DO WHILE .NOT. EOF() .AND. V_PED_HD.HP_EMPR+V_PED_HD.HP_NRO=LP_EMPR+LP_NRO
      IF LOCK()
        DELETE 
      ENDIF
      SKIP
    ENDDO     
  ENDIF
  RELEASE WINDOW ANULA_WI  
  MENSAJE1='!!!! EL PEDIDO HA SIDO ANULADO !!!!' 
  MENSAJE2=''
  DO V_MENSAJ.SPR
  DO PE_VER  
ELSE
  RELEASE WINDOW ANULA_WI  
ENDIF  
RETURN
