******************
PROCEDURE V_NR_OP
******************
OPCION=1

DO V_NR_O.SPR

DO CASE
  CASE LASTKEY()<>27 .AND. OPCION=1
*   ELABORA FACTURA
	IF .NOT. V_USRAUT(USER,"NOTAS_REM",2) .OR. .NOT. V_USRAUT(USER,"FACTURAS",2)
  		RETURN
	ENDIF

    DO V_NR_FAC

  CASE LASTKEY()<>27 .AND. OPCION=2
*   IMPRIME COPIAS DE LA REMISION
    MENSAJE1='SE IMPRIMIRA COPIA DE LA NOTA DE REMISION' 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO NR_IMPR_O
    ENDIF

  CASE LASTKEY()<>27 .AND. OPCION=3
    DO NR_OIMPR

  CASE LASTKEY()<>27 .AND. OPCION=4
*   IMPRIME REMISION SIN INFO DE CLIENTE
    MENSAJE1='CUIDADO, SE IMPRIMIRA NOTA DE REMISION' 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO NR_IMPR_S
    ENDIF

  CASE LASTKEY()<>27 .AND. OPCION=5
*   IMPRIME REMISION VALORADA
    MENSAJE1='CUIDADO, SE IMPRIMIRA NOTA DE REMISION CON DATOS FACTURA' 
    MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
    DO V_MENSAJ.SPR
    IF LASTKEY()<>27
      DO NR_IMPR_F
    ENDIF

  CASE LASTKEY()=27  .OR.  OPCION=6

ENDCASE
DO NR_VER
RETURN

PROCEDURE NR_IMPR_F
*******************
NF=F_GETINF()
SELECT V_DOC_LN
SET ORDER TO NR
SEEK V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.NR'
_PADVANCE='LINEFEED'
REPORT FORM V_NR_FO3 NOCONSOLE REST WHILE V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO=LD_EMPR+LD_TIPO+LD_NRO TO FILE (TEMP_FILE)
_PADVANCE='FORMFEED'
! COPY &TEMP_FILE lpt1:
DO NR_VER
MENSAJE1='NOTA DE REMISION NRO.:'+V_DOC_HD.HD_NRO+' HA SIDO IMPRESA'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE NR_IMPR_O
*******************
SELECT V_DOC_LN
SET ORDER TO NR
SEEK V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.NR'
_PADVANCE='LINEFEED'
REPORT FORM V_NR_FOR NOCONSOLE REST WHILE V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO=LD_EMPR+LD_TIPO+LD_NRO TO FILE (TEMP_FILE)
_PADVANCE='FORMFEED'
! COPY &TEMP_FILE lpt1:
DO NR_VER
MENSAJE1='NOTA DE REMISION NRO.:'+V_DOC_HD.HD_NRO+' HA SIDO IMPRESA'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE NR_IMPR_S
*******************
SELECT V_DOC_LN
SET ORDER TO NR
SEEK V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.NR'
_PADVANCE='LINEFEED'
REPORT FORM V_NR_SIC NOCONSOLE REST WHILE V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO=LD_EMPR+LD_TIPO+LD_NRO TO FILE (TEMP_FILE)
_PADVANCE='FORMFEED'
! COPY &TEMP_FILE lpt1:
DO NR_VER
MENSAJE1='NOTA DE REMISION NRO.:'+V_DOC_HD.HD_NRO+' HA SIDO IMPRESA'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE F_GETINF
******************
*OBTENEMOS INFORMACION DE LA FACTURA
NOMFAC="***"
SELECT 0
USE V_FAC_HD ORDER CORRE
SEEK V_DOC_HD.HD_EMPR+"F"+STR(V_DOC_HD.HD_Ndosif,4)+V_DOC_HD.hd_factura
IF .NOT. EOF()
  NOMFAC=HF_NOM_CL
ENDIF
USE
RETURN NOMFAC  

PROCEDURE NR_IMPR_V
*******************
SELECT V_DOC_LN
SET ORDER TO NR
SEEK V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO     
TEMP_FILE='..\TMP\'+SYS(3)+'.NR'
_PADVANCE='LINEFEED'
REPORT FORM V_NR_FO2 NOCONSOLE REST WHILE V_DOC_HD.HD_EMPR+V_DOC_HD.HD_TIPO+V_DOC_HD.HD_NRO=LD_EMPR+LD_TIPO+LD_NRO TO FILE (TEMP_FILE)
_PADVANCE='FORMFEED'
! COPY &TEMP_FILE lpt1:
DO NR_VER
MENSAJE1='NOTA DE REMISION NRO.:'+V_DOC_HD.HD_NRO+' HA SIDO IMPRESA'
MENSAJE2=''
DO V_MENSAJ.SPR
DELETE FILE (TEMP_FILE)
RETURN

PROCEDURE NR_OIMPR
******************
COPIA=1
FORMATO=1
CON_LOGO=.F.

DO V_NR_OF.SPR

IF LASTKEY()=27
  RETURN
ENDIF

SELECT 0
USE V_ALM ORDER ALM
SEEK V_DOC_HD.HD_EMPR+V_DOC_HD.HD_ALM
ALM_DESCR=AL_DESCR
USE

********** IMPRESION *************** 
SELECT V_DOC_LN
SEEK V_DOC_HD.HD_EMPR+'R'+V_DOC_HD.HD_NRO     
IF .NOT. EOF()
  DO CASE 
    CASE FORMATO=1
      * IMPRIME REMISION VALORADA
      MENSAJE1='CUIDADO, SE IMPRIMIRA NOTA DE REMISION VALORADA' 
      MENSAJE2='[ENTER] PARA CONTINUAR, [ESC] PARA CANCELAR IMPRESION'
      DO V_MENSAJ.SPR
      IF LASTKEY()<>27
        DO NR_IMPR_V
      ENDIF
    CASE FORMATO=2
      * IMPRIME REMISION VALORADA FORMATO WEB
  	  COPIAOR=IIF(COPIA=1,"C O P I A","ORIGINAL")
	  DO V_NRHTM WITH "NO_SETUP", EMPRESA, V_DOC_HD.HD_NRO, COPIAOR, EMPCIUD, SALDO_CTA 
  ENDCASE
ENDIF
SELECT V_DOC_HD
RETURN
