* PROGRAMA PARA OBTENER REPORTE DE REQUERIMIENTOS DE PRODUCCION EMITIDOS

CLOSE ALL
CLEAR
STORE 1 TO IMPRE,RP_IMP,RP_TIPO
STORE ' ' TO DESCR,DEPART
FECHAI=CTOD('01/'+STR(MONTH(DATE()))+'/'+STR(YEAR(DATE())))
FECHAF=CTOD(' ')
DPTO=0
DO V_REP_RP.SPR
IF LASTKEY()=27 .OR. IMPRE=2
   RETURN
ENDIF

SELECT 1
USE V_ITEMS ORDER PART
SELECT 2
USE V_CLIENT ORDER CODIGO
SELECT 3
USE V_PED_LN ORDER CORRE
SELECT 4
USE V_RP_HD ORDER CORRE
SELECT 5
USE V_REQ_PR ORDER CORRE
SET RELATION TO RP_EMPR+RP_PART    INTO V_ITEMS
SET RELATION TO RP_EMPR+RP_PEDIDO  INTO V_PED_LN ADDITIVE
SET RELATION TO RP_EMPR+RP_COD_CLI INTO V_CLIENT ADDITIVE    
SET RELATION TO RP_EMPR+RP_NRO     INTO V_RP_HD  ADDITIVE
IF DPTO=11 && Reporte General
 WAIT WINDOW "General" 
 DO CASE 
  CASE RP_TIPO=1 .AND. RP_IMP=1
   SET ORDER TO linea
   DEFINE WINDOW RP FROM 0,0 TO 24,79 TITLE '> Presione [Esc] para Salir <'
   REPORT FORM V_RP_TOT FOR RP_EMPR='1' .AND. RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_RP_TOT.TXT NOCONSOLE
   MODI COMM V_RP_TOT.TXT WINDOW RP NOEDIT
   RELEASE WINDOW RP
  CASE RP_TIPO=1 .AND. RP_IMP=2
   SET ORDER TO linea
   REPORT FORM V_RP_TOT FOR RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_RP_TOT.TXT NOCONSOLE
   ! NPRINT V:V_RP_TOT.TXT NB NFF NT Q=SERVER  
  CASE RP_TIPO=2 .AND. RP_IMP=1
   DEFINE WINDOW RP FROM 0,0 TO 24,79 TITLE '> Presione [Esc] para Salir <'
   REPORT FORM V_REP_RP FOR RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_REP_RP.TXT NOCONSOLE
   MODI COMM V_REP_RP.TXT WINDOW RP NOEDIT
   RELEASE WINDOW RP
  CASE RP_TIPO=2 .AND. RP_IMP=2
   REPORT FORM V_REP_RP FOR RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_REP_RP.TXT NOCONSOLE
   ! NPRINT V:V_REP_RP.TXT NB NFF NT Q=SERVER
  ENDCASE
  CLOSE ALL 
ELSE   && Reporte Individual
 DO CASE
  CASE RP_TIPO=1 .AND. RP_IMP=1
   SET ORDER TO PART
   DEFINE WINDOW RP FROM 0,0 TO 24,79 TITLE '> Presione [Esc] para Salir <'
   REPORT FORM V_RP_TOT FOR RP_NRO=DEPART .AND.RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_RP_TOT.TXT NOCONSOLE
   MODI COMM V_RP_TOT.TXT WINDOW RP NOEDIT
   RELEASE WINDOW RP
  CASE RP_TIPO=1 .AND. RP_IMP=2
   SET ORDER TO PART
   REPORT FORM V_RP_TOT FOR RP_NRO=DEPART .AND.RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_RP_TOT.TXT NOCONSOLE
   ! NPRINT V:V_RP_TOT.TXT NB NFF NT Q=SERVER  
  CASE RP_TIPO=2 .AND. RP_IMP=1
   DEFINE WINDOW RP FROM 0,0 TO 24,79 TITLE '> Presione [Esc] para Salir <'
   REPORT FORM V_REP_RP FOR RP_NRO=DEPART .AND.RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_REP_RP.TXT NOCONSOLE
   MODI COMM V_REP_RP.TXT WINDOW RP NOEDIT
   RELEASE WINDOW RP
  CASE RP_TIPO=2 .AND. RP_IMP=2
   REPORT FORM V_REP_RP FOR RP_NRO=DEPART .AND.RP_FECHA>=FECHAI.AND.RP_FECHA<=FECHAF ;
   TO FILE V_REP_RP.TXT NOCONSOLE
   ! NPRINT V:V_REP_RP.TXT NB NFF NT Q=SERVER
  ENDCASE
  CLOSE ALL
ENDIF  
RETURN
