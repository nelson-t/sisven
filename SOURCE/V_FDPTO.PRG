* PROGRAMA PARA OBTENER UN REPORTE DE LAS FACTURAS
* EMITIDAS, AGRUPADAS POR DEPARTAMENTO

SET EXCLU OFF
SET DELE ON
SET DATE TO FRENCH
CLOSE DATA
CLEAR
SET TALK OFF
IVA=0.87   && 1-0.13
mi_empresa=space(30)
EMPRESA=' '
FECHAI={  /  /    }
FECHAF={  /  /    }
OPCION=1

DO V_FDPTO.SPR

IF LASTKEY()=27
  RETURN
ENDIF

SELECT 1
   USE V_ITEMS ORDER PART
SELECT 2
   USE V_CLIENT ORDER CODIGO   
SELECT 3
   USE V_TC ORDER FECHA
SELECT 4
   USE V_FAC_HD ORDER CORRE   
SELECT 5
   USE V_FAC_LN ORDER PART
   SET RELATION TO DTOS(LF_FECHA) INTO V_TC
   SET RELATION TO LF_EMPR+LF_PART INTO V_ITEMS ADDITIVE
   SET RELATION TO LF_EMPR+LF_COD_CL INTO V_CLIENT ADDITIVE
   SET RELATION TO LF_EMPR+'F'+LF_NRO INTO V_FAC_HD ADDITIVE

DO CASE
  CASE OPCION=1 .AND. LASTKEY()<>27
    REPORT FORM V_FDPTO FOR LF_EMPR=EMPRESA .AND. LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. LF_PART<>' ' TO FILE V:V_FDPTO.TXT
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM V:V_FDPTO.TXT WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  CASE OPCION=2 .AND. LASTKEY()<>27
    REPORT FORM V_FDPTO FOR LF_EMPR=EMPRESA .AND. LF_FECHA>=FECHAI .AND. LF_FECHA<=FECHAF .AND. LF_PART<>' ' TO FILE V:V_FDPTO.TXT
    ! NPRINT V:V_FDPTO.TXT NB NFF Q=SERVER   
  CASE OPCION=3 .OR. LASTKEY()=27
ENDCASE
CLOSE ALL
RETURN

FUNCTION GET_EMPR
*****************
PARAMETER EMPR
SELECT 0
USE V_EMPR ORDER EMPR
SEEK EMPR
IF EOF()
  USE
  RETURN .F.
ELSE
  MI_EMPRESA=EM_DESCR
  @ 8,44 SAY MI_EMPRESA
  USE
  RETURN .T.
ENDIF
