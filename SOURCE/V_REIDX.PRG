CLEAR
WAIT "TODOS LOS USUARIOS DEBEN SALIR... PRESIONE [ENTER] PARA SEGUIR" WINDOW
IF LASTKEY()=27
  RETURN
ENDIF

SET EXCLU ON
SET TALK ON
CLOSE ALL

ON ERROR DO errhand WITH ERROR(), MESSAGE()

SELECT 1
USE V_TABLES ORDER DBF

DO WHILE .NOT. EOF()
  SELECT 2
  USE (v_tables.TB_DBF)
  PACK
  REINDEX
  SELECT 1 
  SKIP
ENDDO

WAIT 'PROCESO CONCLUIDO SATISFACTORIAMENTE ...PRESIONE [ENTER]' WINDOW 

ON ERROR
CLOSE ALL
SET TALK OFF
CLEAR

PROCEDURE errhand
************************
PARAMETER errnum,message
SET TALK OFF

CLEAR
@ 12,0 SAY 'SE ENCONTRO EL ERROR: '+message
@ 14,0 SAY '      TIPO DE ERROR : '+STR(Errnum)
@ 16,0

IF errnum=15
   WAIT 'EL PROGRAMA INTENTARA ARREGLAR LAS TABLAS ... PRESIONE [ENTER]'
   Close databases
   SET DEFA TO ..\DBF
   do V_FIXDBF
   WAIT "EL PROGRAMA TERMINARA .. VUELVA A EJECUTAR EL PROGRAMA PARA VERIFICAR"    
   quit
ENDIF

WAIT "EL PROGRAMA TERMINARA ... PRESIONE [ENTER]" 
RETURN TO MASTER