*** MIGRA DBF DE UN DIRECTORIO DBF ESPECIFICADO
CLEAR

WAIT "TODOS LOS USUARIOS DEBEN SALIR... PRESIONE [ENTER] O [ESC]" WINDOW
IF LASTKEY()=27
  RETURN
ENDIF

@ 3,0 SAY "ESTE PROGRAMA BORRARA TODO LOS DATOS Y LOS MIGRARA DESDE OTRA UBICACION ..." 
WAIT "PRESIONE [ENTER] O [ESC]"
IF LASTKEY()=27
  RETURN
ENDIF

@ 7,0 SAY "INTRODUZCA RUTA DONDE SE ENCUENTRA DATO A MIGRAR (DBF)"
@ 8,0 SAY "EJEMPLO: D:\SISTEMAS\VENTASV4.0\DBF\"
RUTA=SPACE(70)

@ 9,0 SAY "-->"
@ 9,5 GET RUTA
READ
RUTA=ALLTRIM(RUTA)

IF LASTKEY()=27 OR LEN(RUTA)=0
  RETURN
ENDIF

IF NOT FILE(RUTA+'v_empr.dbf')
  WAIT "ERROR, RUTA INCORRECTA..."+RUTA+'v_empr.dbf'
  RETURN 
ENDIF  

ON ERROR DO errhand WITH ERROR(), MESSAGE()

CLOSE ALL
SET EXCLU ON
SET TALK ON

SELECT 1
USE V_TABLES ORDER DBF
******* IMPORTANTE
SET FILTER TO TB_MIGRA
*******
DO WHILE .NOT. EOF()
  IF FILE(RUTA+v_tables.TB_DBF)
    SELECT 2
    USE (v_tables.TB_DBF)
    ? "Procesando: "+v_tables.TB_DBF+" "+v_TABLES.TB_DSCR
    ZAP
    REINDEX
    ? "Leyendo desde: "+RUTA+v_tables.TB_DBF
    APPEND FROM (RUTA+v_tables.TB_DBF)
    GO TOP
    COUNT ALL TO N
    USE
    SELECT 1 
    REPLACE V_TABLES.TB_NMIGRA with N
    ? "---"
  ELSE
    ? "Procesando: "+v_tables.TB_DBF+" "+v_TABLES.TB_DSCR
    ? "ERROR     : NO SE ENCONTRO LA TABLA"
    ? "---"
    WAIT "ERROR, NO SE ENCONTRO LA TABLA" WINDOW
  ENDIF
  SKIP
ENDDO
WAIT 'PROCESO CONCLUIDO SATISFACTORIAMENTE ...PRESIONE [ENTER]' WINDOW 

ON ERROR
CLOSE ALL
SET EXCLU OFF
SET TALK OFF
CLEAR

PROCEDURE errhand
************************
PARAMETER errnum,message
SET TALK OFF
SET EXCLU OFF

CLEAR
@ 12,0 SAY 'SE ENCONTRO EL ERROR: '+message
@ 14,0 SAY '      TIPO DE ERROR : '+STR(Errnum)
@ 16,0
WAIT "PRESIONE [ENTER] PARA CERRAR Y SALIR" 
CLOSE ALL
RETURN TO MASTER
