CLOSE DATA
SET DELE ON
SET TALK OFF
SET EXCLU OFF
SET EXACT OFF

CLEAR
PRIMERA=' '
PRES_OK=.T.

SELECT 1
USE V_LINEAS ORDER LINEA
GO TOP
N=1

DO WHILE .NOT. EOF()
  IF SUBSTR(LI_LINEA,1,1)<>' ' .AND. SUBSTR(LI_LINEA,2,2)='  '
    @ 10+N,30 SAY ALLTRIM(LI_LINEA)+'-'+LI_DESCR
    N=N+1
  ENDIF
  SKIP
ENDDO


@ 5,10 TO 9,70
@ 7,20 SAY 'INGRESE LA PRIMERA LETRA DE LA LINEA:' GET PRIMERA PICTURE '!' COLOR GR+/B
READ

CLEAR

IF LASTKEY()=27
  CLOSE DATA
  RETURN
ENDIF
 

DEFINE WINDOW  MOD_LINEAS FROM 0,11 TO 21,68

ON KEY LABEL F10 KEYBOARD CHR(23)
ON KEY LABEL F4  DO ADD_REG
ON KEY LABEL F8  DO BORRA
ON KEY LABEL F6  DO MODI_REG
@ 22,5 to 24,75 DOUBLE

SET FILTER TO LI_LINEA=ALLTRIM(PRIMERA)

@ 23,10 SAY '[F4]-ADICIONA  [F6]-MODIFICA REG.  [F8]-BORRA  [F10]-SALIR' COLOR GR+/B
DO WHILE .T.

  BROW FIELDS LI_EMPR:H='EMPRESA', ;
       LI_LINEA:H='LINEA':V=ES_UNICO(LI_EMPR,LI_LINEA):E='CODIGO DE LINEA YA EXISTE', LI_DESCR:H='DESCRIPCION', ;
       LI_PRES_KG:H='PRES.kg.':W=PRES_OK, ;
       LI_PRES_US:H='PRES.US$':W=PRES_OK ;
       WINDOW MOD_LINEAS TITLE 'TABLA DE LINEAS DE AGRUPACION' ;
       NOEDIT NODELETE NOAPPEND
  
  IF LASTKEY()=23
    EXIT
  ENDIF

ENDDO        

CLOSE DATA
RELEASE WINDOW MOD_LINEAS
CLEAR
RETURN     

PROCEDURE BORRA
***************
WAIT 'BORRARA EL REG.? [ESC] PARA CANCELAR, OTRA TECLA PARA CONTINUAR' WINDOW
IF .NOT. LASTKEY()=27
  REPLACE LI_MIGRA WITH ' '
  DELETE 
  KEYBOARD CHR(27)
ENDIF  
RETURN

FUNCTION ES_UNICO
*****************
PARAMETER EMPRESA,LINEA
MI_REC=RECNO()
MI_LINEA=LI_LINEA
REPLACE LI_LINEA WITH ' X '
SEEK EMPRESA+LINEA
IF .NOT. EOF()
  GO MI_REC
  REPLACE LI_LINEA WITH '   '
  RETURN .F.
ELSE
  GO MI_REC
  REPLACE LI_LINEA WITH MI_LINEA
  RETURN .T.
ENDIF      


PROCEDURE MODI_REG
******************
ADD_OK=.F.
OK_CANCEL=1

SCATTER MEMVAR

DO V_MANLIN.SPR

IF OK_CANCEL=1
  IF LOCK()
    GATHER MEMVAR
    REPLACE LI_MIGRA WITH ' '
  ENDIF
ENDIF

RETURN  

PROCEDURE ADD_REG
*****************
ADD_OK=.T.
OK_CANCEL=1

SCATTER MEMVAR BLANK

DO V_MANLIN.SPR

IF OK_CANCEL=1
  APPEND BLANK
  IF LOCK()
    GATHER MEMVAR
    REPLACE LI_MIGRA WITH ' '
  ENDIF
ENDIF

RETURN  