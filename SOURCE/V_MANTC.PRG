PROCEDURE V_MANTC
*****************
PARAMETER CUALTC

** SI NO SE ENVIA PARAMETRO SE ASIGNARA AUTOMATICAMENTE "USD"
ON ERROR STORE "USD" TO CUALTC
=IIF(CUALTC="USD",1,0)
ON ERROR
**

** SETUP
CLOSE DATA
SET DELE ON
SET TALK OFF
SET EXCLU OFF
SET EXACT OFF
SET DATE TO DMY
PRIMERA=' '

IF CUALTC="USD"
 SELECT 1
 USE V_TC ORDER FECHA
 TITULO="USD"
ELSE
 SELECT 1
 USE V_UFV ORDER FECHA
 TITULO="UFV"
ENDIF

GO BOTT
RECN=RECNO()

CLEAR

DEFINE WINDOW  MOD_TC FROM 0,28 TO 20,52

ON KEY LABEL F10 KEYBOARD CHR(23)
ON KEY LABEL F4  KEYBOARD CHR(14)
ON KEY LABEL F8  DO BORRATC
ON KEY LABEL F9  DO RELLENA

ON KEY LABEL ALT+HOME GO TOP
ON KEY LABEL ALT+END GO BOTT

@ 21,5 to 24,75 DOUBLE
@ 22,12 SAY '[F4]-ADICIONA  [F8]-BORRA [F9]-RELLENA  [F10]-SALIR' COLOR GR+/B
@ 23,12 SAY '       Alt+HOME-IR A INICIO   Alt+END-IR AL FINAL' 

@ 0,0 SAY DATE()

DO WHILE LASTKEY()<>23
  BROW FIELDS TC_FECHA:H='FECHA':11:V=ES_UNICO(TC_FECHA):E='ESA FECHA YA EXISTE !!!', ;
     TC_MONTO:9:H='Bs./'+TITULO ;
     VALID ESVALIDO() ERROR "DATOS INCORRECTOS!" ;
     NODELETE WINDOW MOD_TC TITLE 'TASAS DE CAMBIO: '+TITULO
ENDDO

CLOSE DATA
RELEASE WINDOW MOD_TC

ON KEY LABEL F10 
ON KEY LABEL F4  
ON KEY LABEL F8  
ON KEY LABEL F9

ON KEY LABEL ALT+HOME 
ON KEY LABEL ALT+END 

CLEAR
RETURN     

PROCEDURE RELLENA
*****************
SET FILTER TO TC_MONTO<>0
GO BOTTOM
ULT_TC=TC_MONTO
ULT_FECHA=TC_FECHA

DO WHILE ULT_FECHA<DATE()
  APPEND BLANK
  ULT_FECHA=ULT_FECHA+1
  REPLACE TC_FECHA WITH ULT_FECHA
  REPLACE TC_MONTO WITH ULT_TC
ENDDO
SET FILTER TO
GO BOTTOM
RETURN  

PROCEDURE BORRATC
*****************
IF LOCK()
 IF TC_FECHA={  /  /    }
   RECN=-1   
 ELSE
   RECN=RECNO()
 ENDIF
 DELETE
 IF RECN = -1
   GO BOTT
 ELSE
   GO RECN
 ENDIF
 KEYBOARD '{ESC}'
ELSE
 WAIT "NO SE PUEDE BORRAR...INTENTE OTRA VEZ MAS TARDE" WINDOW
ENDIF
RETURN
 
FUNCTION ESVALIDO
*****************
IF TC_FECHA={  /  /    } .OR. TC_MONTO=0
  RETURN .F.
ELSE
  RETURN .T.
ENDIF

FUNCTION ES_UNICO
*****************
PARAMETER FECHA
MI_REC=RECNO()
MI_FECHA=TC_FECHA
REPLACE TC_FECHA WITH {01/01/01}
SEEK DTOS(FECHA)
IF .NOT. EOF()
  GO MI_REC
  REPLACE TC_FECHA WITH {  /  /  }
  RETURN .F.
ELSE
  GO MI_REC
  REPLACE TC_FECHA WITH MI_FECHA
  RETURN .T.
ENDIF      
