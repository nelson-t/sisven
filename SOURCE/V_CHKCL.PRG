FUNCTION V_CHKCL
****************
PARAMETER CODIGO, NOMVARX, TIPOVARX, NOMVARM, FILTROCL
*CODIGO  =CODIGO CLIENTE
*NOMVARX =NOMBRE DE CAMPO DE *BD* A ACTUALIZAR
*NOMVARM =NOMBRE DE VARIABLE EN *MEMORIA* A ACTUALIZAR
*FILTROCL=PARA FILTRAR POR TIPO ESPECIFICADO DE CLIENTES

CURRENT=SELECT()
CERRARDBF=.F.
RAZON=''

IF SELECT("V_CLIENT")=0
  CERRARDBF=.T.
  SELECT 0
  USE V_CLIENT ORDER CODIGO
ENDIF
  
SELECT V_CLIENT
SET FILTER TO CL_EMPR=EMPRESA AND CL_CATEGO=FILTROCL

SEEK EMPRESA+CODIGO
IF FOUND()
  RAZON= CL_RAZON
ELSE

  CODIGO=CL_FILTER()

  SEEK EMPRESA+CODIGO
  IF FOUND()
    RAZON=CL_RAZON
  ENDIF
  RELEASE POPUP GETCLIEN
ENDIF    

SELECT V_CLIENT
SET FILTER TO CL_EMPR=EMPRESA
IF CERRARDBF
  USE
ENDIF

SELECT (CURRENT)

IF .NOT. ''=NOMVARX
  IF TIPOVARX="DB"
    REPLACE (NOMVARX) WITH CODIGO
  ELSE
    STORE CODIGO TO (NOMVARX)
  ENDIF  
ENDIF

IF .NOT. ''=NOMVARM
  STORE RAZON TO (NOMVARM) 
ENDIF

RETURN .T.

FUNCTION CL_FILTER
*******************
SELECT V_CLIENT
SET ORDER TO RAZON
DEFINE POPUP GETCLIEN FROM 8,20 TO 20,60 ;
	PROMPT FIELD SUBSTR(CL_RAZON,1,30)+'-'+CL_COD_CL ;
	TITLE 'SELECCIONE CLIENTE CON [ENTER]' 
ON SELECTION POPUP GETCLIEN DEACTIVATE POPUP
  
DEFINE WINDOW FILTERCL ;
		FROM 5, 10 ;
		TO 09,70 ;
		TITLE "FILTRO DE BUSQUEDA" ;
		NOFLOAT ;
		DOUBLE 

ACTIVATE WINDOW FILTERCL
FILTER1=space(30)
@ 1,3  say "Filtrar nombres con:"
@ 1,25 get FILTER1 
READ
Release Window FILTERCL
      
if filter1<>space(30)
  set filter to upper(alltrim(filter1))$upper(cl_razon)
endif
  
ACTIVATE POPUP GETCLIEN
SELECT V_CLIENT
  
if filter1<>space(30)
  set filter to
endif

RELEASE POPUP GETCLIEN

SET ORDER TO CODIGO
SEEK EMPRESA+SUBSTR(PROMPT(),32,6)

RETURN CL_COD_CL
