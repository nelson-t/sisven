SET EXCLU OFF
SET DELE ON
CLOSE DATA
CLEAR
SET TALK OFF
RES_DET=1

DO V_RNRS2.SPR 
IF RES_DET=2
  DO V_NRXFAC
  RETURN
ENDIF

IF TYPE("EMPRESA")="U" OR TYPE("MI_EMPRESA")="U" OR TYPE("INI_GEST")="U"
  DO V_GETEMP
ENDIF

SELECT 1
USE V_DOC_HD ORDER NR
SELECT 2
USE V_CLIENTES ORDER CODIGO

SELECT 1
SET RELATION TO HD_EMPR+HD_COD_CL INTO V_CLIENT

FECHAI=INI_GEST
FECHAF=DATE()

OPCION=1

DO V_RNRS.SPR

IF LASTKEY()=27 .OR. OPCION=3
 CLOSE DATA
 CLEAR 
 RETURN
ENDIF

NRS=SYS(3)
NRS_REP='..\TMP\'+NRS+'.TXT' 

SELECT V_DOC_HD
SET FILTER TO HD_EMPR=EMPRESA .AND. .NOT. HD_ESTADO$'AF' .AND. HD_TIPO$'NR' .AND. BETWEEN(HD_FECHA,FECHAI,FECHAF) ;
              .AND. HD_COD_CL<>'000'

DO CASE
  CASE OPCION=1 .AND. LASTKEY()<>27
    REPORT FORM V_RNRS TO FILE (NRS_REP)
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM (NRS_REP) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  CASE OPCION=2 .AND. LASTKEY()<>27
    REPORT FORM V_RNRS TO FILE (NRS_REP)
    ! COPY &NRS_REP lpt1:
  CASE OPCION=3 .OR. LASTKEY()=27
ENDCASE
CLEAR
CLOSE DATA
WAIT "PROCESO CONCLUIDO...SALIENDO." TIMEOUT 2
DELETE FILE (NRS_REP)
RETURN

