******************
PROCEDURE V_FAC_OP
******************
OPCION=1

DO V_FAC_O.SPR

DO CASE
  CASE LASTKEY()<>27 .AND. OPCION=1
    SELECT V_FAC_HD
    DO V_FAC_MD.SPR
  CASE LASTKEY()<>27 .AND. OPCION=2
    IF V_FAC_HD.HF_ESTADO<>"A"
       DO FAC_IMPR 
    ENDIF
ENDCASE
DO FAC_VER
RETURN

PROCEDURE FAC_IMPR
******************
COPIA=1
FORMATO=1
CON_LOGO=.F.

DO V_FAC_OF.SPR

IF LASTKEY()=27
  RETURN
ENDIF

SELECT 0
USE V_ALM ORDER ALM
SEEK V_FAC_HD.HF_EMPR+V_FAC_HD.HF_ALM
ALM_DESCR=AL_DESCR
USE

********** IMPRESION *************** 
MI_TC=GET_TC(V_FAC_HD.HF_FECHA)

SELECT V_FAC_LN
SEEK V_FAC_HD.HF_EMPR+'F'+str(V_FAC_HD.HF_NDOSIF,4)+V_FAC_HD.HF_NRO     
IF .NOT. EOF()
    DO CASE 
      CASE FORMATO=1
        _PADVANCE='LINEFEED'
		TEMP_FILE='..\TMP\'+'F_'+V_FAC_LN.LF_NRO+'.TXT'

      	REPORT FORM V_FA_FOR NOCONSOLE REST ;
      	       WHILE V_FAC_HD.HF_TIPO$"RO" .AND. V_FAC_HD.HF_EMPR+str(V_FAC_HD.HF_NDOSIF,4)+V_FAC_HD.HF_NRO=LF_EMPR+STR(LF_NDOSIF,4)+LF_NRO TO FILE (TEMP_FILE)

     	! COPY &TEMP_FILE lpt1:

   		DELETE FILE (TEMP_FILE)
	    MENSAJE1='FACTURA NRO.:'+str(V_FAC_HD.HF_NDOSIF,4)+"-"+V_FAC_HD.HF_NRO+' HA SIDO IMPRESA'
    	MENSAJE2=''
    	DO V_MENSAJ.SPR
    	_PADVANCE='FORMFEED'

      CASE FORMATO=2
		COPIAOR=IIF(COPIA=1,"C O P I A","ORIGINAL")
		DO V_FACHTM WITH "NO_SETUP", EMPRESA, V_FAC_HD.HF_NRO, V_FAC_HD.HF_NDOSIF, COPIAOR, EMPCIUD

    ENDCASE

ENDIF

SELECT V_FAC_HD
RETURN


FUNCTION GET_TC
***************
PARAMETER WFECHA
CURRENT=SELECT()
SELECT 0
USE V_TC ORDER FECHA
SEEK DTOS(WFECHA)
WTC=TC_MONTO
USE
SELECT (CURRENT)
RETURN WTC