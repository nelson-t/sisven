* PROGRAMA PARA CALCULAR EL Costo Variable
* DE LOS ITEMS, EL COSTO SE ALMACENARA EN
* LA TABLA DE ITEMS, EN EL CAMPO IT_COSTO

CLOSE DATA
SELECT 1
  USE V_MATER ORDER MATER  
SELECT 2
  USE V_FORMUL ORDER PART
  SET RELATION TO FO_EMPR+FO_MATER INTO V_MATER
SELECT 3
  USE V_ITEMS ORDER PART
  REPLACE IT_COSTO WITH 0 ALL
  SET RELATION TO IT_EMPR+IT_PART INTO V_FORMUL ADDITIVE
  GO TOP
  DO WHILE .NOT. EOF()
     SELECT V_FORMUL
     SEEK V_ITEMS.IT_EMPR+V_ITEMS.IT_PART
     IF FOUND()
        DO WHILE FO_PART=V_ITEMS.IT_PART
           IF LOCK('V_ITEMS')
           REPLACE V_ITEMS.IT_COSTO WITH V_ITEMS.IT_COSTO + ;
                  (V_ITEMS.IT_PESO_T  * FO_PORCEN / 100 * V_MATER.MA_PRECIO)
           SKIP
           ENDIF       
        ENDDO       
     ENDIF
     SELECT V_ITEMS
     SKIP
  ENDDO
CLOSE DATA
RETURN
