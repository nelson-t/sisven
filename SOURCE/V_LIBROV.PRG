SET EXCLU OFF
SET DELE ON
SET DATE FRENCH
CLOSE DATA
CLEAR
SET TALK OFF
SET EXACT OFF

m.mes_anio = space(15)

IF TYPE("EMPRESA")="U" OR TYPE("MI_EMPRESA")="U"
  DO V_GETEMP
ENDIF

FECHAI=ctod("01/" + alltrim(str(month(date()),2,0))+ "/"+ str(year(date()),4,0))

FECHAF=DATE()

OPCION=1
REP_ARCH='..\TMP\'+SYS(3)+'.TXT'

DO V_LIBROV.SPR

IF LASTKEY()=27 .OR. OPCION=4
  RETURN
ENDIF

DO V_RPROCE WITH EMPRESA, FECHAI, FECHAF

SELECT 1
USE V_FAC_HD ORDER CORRE
SELECT 2
USE V_CLIENT ORDER CODIGO
SELECT 3 
USE V_FAC_LN ORDER CORRE
SELECT 4
USE V_ITEMS ORDER PART
SELECT 5
USE V_DOSIFI ORDER NRO

SELECT V_FAC_LN
SET RELATION TO LF_EMPR+LF_PART INTO V_ITEMS

SELECT V_FAC_HD
SET RELATION TO HF_COD_CL INTO V_CLIENT
SET RELATION TO HF_EMPR+STR(HF_NDOSIF,4,0) INTO V_DOSIFI ADDITIVE

SELECT V_FAC_HD
DO CASE
  CASE OPCION=1 .AND. LASTKEY()<>27
    REPORT FORM V_LIBROV FOR HF_EMPR=EMPRESA .AND. HF_FECHA>=FECHAI .AND. HF_FECHA<=FECHAF .AND. HF_TIPO$'OR' TO FILE (REP_ARCH)
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM (REP_ARCH) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  CASE OPCION=2 .AND. LASTKEY()<>27
    REPORT FORM V_LIBROV FOR HF_EMPR=EMPRESA .AND. HF_FECHA>=FECHAI .AND. HF_FECHA<=FECHAF .AND. HF_TIPO$'OR' TO FILE (REP_ARCH)
    ! COPY &REP_ARCH lpt1:
  CASE OPCION=3 .AND. LASTKEY()<>27 &&EXCEL
    REPORT FORM V_LIBRO2 FOR HF_EMPR=EMPRESA .AND. HF_FECHA>=FECHAI .AND. HF_FECHA<=FECHAF .AND. HF_TIPO$'OR' TO FILE (REP_ARCH)
    DEFINE WINDOW VER_REP FROM 0,0 TO 24,79 DOUBLE TITLE '[ESC] - PARA SALIR'
    MODI COMM (REP_ARCH) WINDOW VER_REP NOEDIT
    RELEASE WINDOW VER_REP    
  CASE OPCION=4 .OR. LASTKEY()=27
ENDCASE
CLEAR
CLOSE DATA
WAIT "PROCESO CONCLUIDO...SALIENDO." TIMEOUT 2
DELETE FILE (REP_ARCH)
RETURN

PROCEDURE MES_ANIO
******************
** DEVUELVE EL MES Y ANIO PARA SER IMPRESO EN EL REPORTE DE VENTAS
DO CASE
	CASE MONTH(FECHAI)=1
		m.mes_anio = 'ENERO'
	CASE MONTH(FECHAI)=2
		m.mes_anio = 'FEBRERO'
	CASE MONTH(FECHAI)=3
		m.mes_anio = 'MARZO'
	CASE MONTH(FECHAI)=4
		m.mes_anio = 'ABRIL'
	CASE MONTH(FECHAI)=5
		m.mes_anio = 'MAYO'
	CASE MONTH(FECHAI)=6
		m.mes_anio = 'JUNIO'
	CASE MONTH(FECHAI)=7
		m.mes_anio = 'JULIO'
	CASE MONTH(FECHAI)=8
		m.mes_anio = 'AGOSTO'
	CASE MONTH(FECHAI)=9
		m.mes_anio = 'SEPTIEMBRE'
	CASE MONTH(FECHAI)=10
		m.mes_anio = 'OCTUBRE'
	CASE MONTH(FECHAI)=11
		m.mes_anio = 'NOVIEMBRE'
	CASE MONTH(FECHAI)=12
		m.mes_anio = 'DICIEMBRE'		
ENDCASE
m.mes_anio = m.mes_anio + '/' + STR(YEAR(FECHAI),4)
RETURN

FUNCTION FORFECHA
*****************
PARAMETER FECHA

SET DATE TO YMD
_FECHAF=STRTRAN(dtoc(FECHA),"/", "")
SET DATE TO DMY
RETURN _FECHAF